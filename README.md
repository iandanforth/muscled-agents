# MuscledAgents
OpenAI Gym MuJoCo models rigged with muscles and environments which
incorporate PyMuscle fatigable muscle models.

## Prerequisites

 - MuJoCo 1.5
 - mujoco-py

## Setup

```
python setup.py develop
```

## Getting Started

The only functional environment is currently `ant`. Please run that as follows

```
cd agents
python ant.py
```

If things go well you'll see the standard `ant` model now rigged with tendons
and moving in a simple dance-like pattern.

## Usage

To explore these environments and models further you will need to understand
how input values get translated into final simulated movements.

### Control Signals

The action space for an ant is continuous control over 16 muscles. For
each of four legs there are four muscles. One leg extensor, one leg flexor,
and two hip muscles which move the leg left and right (or forward and back
depending on your perspective.)

### Gym Environment

The `step` method takes an array of 16 values which represent the input to
the fatigable muscle model for each muscle. Currently a the `ant` env responds
to values in the range [0-60]. (As this range is non-intuitive it is likely to
change in the future.)

### PyMuscle Model

The range of valid input values for the muscle model is determined by the
instantiation characteristics of the muscle. You can think of these inputs
as the spikes / second that the motor nuclei for each muscle receive. Each
muscle responds slightly differently and within a muscle each motor unit
will be recruited at a different level of input.

For example if you send an input value of 20 to the muscle model a small number
of weak motor units will be recruited and a small fraction of the total possible
force will be generated by the muscle. If, however, you use an value of 60 then
all or nearly all the motor units will be recruited and the muscle will produce
maximal voluntary output.

Output values are normalized by the maximum voluntary force the muscle can
produce. That value is a function of its instantiation characteristics. Output
values will thus usually be between 0.0 and 1.0.

### PyMuscle Fatigue

After use muscles produce less force for the same level of input. So if you
were to send an input signal which recruited all motor units in a muscle
constantly for several seconds the output the model will return will rapidly
decrease. A period of light or no use is required for the muscle to recover.

### MuJoCo Model

Each tendon actuator is control limited to the range [-3.0, 0.0]. When a
General actuator is tied to a Tendon in MuJoCo negative values are the
equivalent of contractions. Muscles cannot produce force in extension so no
positive non-zero values are allowed.

The expected input range is [-1.0, 0.0] which is the equivalent of voluntary
force. However real muscles can actually produce 3x voluntary force under
certain circumstances so we reserve that here for future use.

Actuators have a `gainprm` which scales this input value. This is tuned to
a value of 200 to work with the mass of the ant and the resistances of opposing
tendons.

## Altering the Models

Due to frustration editing XML files the `ant` model is generated by a python
script that uses the `mjcf` library which I wrote to wrap MuJoCo xml elements
in python classes. 

You can view and modify that script in `scripts/gen_ant.py` if you choose
but the intent of this collection of environments is to provide a standard
for further experimentation.
